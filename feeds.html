---
layout: page
permalink: /feeds
title: 動態
icon: fa-comment-dots
order: 4
---

<div id="modal-create" class="modal logged-in">
    <div class="modal-content">
      <form id="feeds-form">
        <div class="input-field">
            <label for="content">在想甚麼呢？</label>
            <textarea id="content" style="min-height: 150px;" required></textarea>
        </div>
        <div style="text-align: right;">
            <button >發表</button>
        </div>
      </form>
    </div>
</div>


<div class="feeds">

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-md5/2.1.0/js/md5.js"></script>
<script>
// create new guides

const user = auth.currentUser;
    if(user){
        //console.log('user logged in: ', user);
        user.getIdTokenResult().then(idTokenResult => {
            user.admin = idTokenResult.claims.admin;
            setupUI(user);
        })
    } else { 
        //console.log('user logged out.');
        setupUI();
    }


    const createForm = document.querySelector('#feeds-form');
    createForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const user = auth.currentUser;
        //console.log(user);
        db.collection('feeds').add({
            author: user.uid,
            content: createForm['content'].value,
            postedAt: firebase.firestore.Timestamp.now(),
            date: firebase.firestore.Timestamp.now().toDate()
        }).then(() => {
            // close modal and reset form
            createForm.reset();
        }).catch(err => {
            console.log(err.message);
        })

    })
</script>